<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ELANORA - Export & Preview</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <h1 class="logo">ELANORA</h1>
            <nav class="nav">
                <a href="projects.html" class="nav-link">Projects</a>
                <a href="index.html" class="nav-link">Dashboard</a>
                <a href="conflicts.html" class="nav-link">Conflicts <span class="badge">3</span></a>
                <a href="tiers.html" class="nav-link">Tier Management</a>
                <a href="export.html" class="nav-link active">Export</a>
                <div class="user-menu">
                    <span>Dr. Martin</span>
                    <button class="btn-logout" onclick="logout()">Logout</button>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Page Header -->
            <section class="page-header">
                <div class="header-info">
                    <h2>Export & Preview</h2>
                    <p>Project: LSFB Discourse Analysis</p>
                </div>
                <div class="header-actions">
                    <button class="btn-secondary" onclick="saveConfiguration()">
                        üíæ Save Configuration
                    </button>
                    <button class="btn-primary" onclick="generateExport()">
                        üìÅ Generate Export
                    </button>
                </div>
            </section>

            <div class="export-layout">
                <!-- Export Configuration Sidebar -->
                <aside class="export-sidebar">
                    <div class="config-section">
                        <h3>Export Configuration</h3>
                        
                        <!-- File Selection -->
                        <div class="config-group">
                            <h4>Source Files</h4>
                            <div class="file-selection">
                                <label class="file-checkbox">
                                    <input type="checkbox" checked data-file="session_001_discourse.eaf">
                                    <span class="checkmark"></span>
                                    session_001_discourse.eaf
                                </label>
                                <label class="file-checkbox">
                                    <input type="checkbox" checked data-file="session_002_fluence.eaf">
                                    <span class="checkmark"></span>
                                    session_002_fluence.eaf
                                </label>
                                <label class="file-checkbox">
                                    <input type="checkbox" data-file="session_003_prosody.eaf">
                                    <span class="checkmark"></span>
                                    session_003_prosody.eaf
                                </label>
                            </div>
                        </div>

                        <!-- Tier Group Selection -->
                        <div class="config-group">
                            <h4>Tier Groups</h4>
                            <div class="tier-selection">
                                <div class="tier-group">
                                    <label class="group-header">
                                        <input type="checkbox" checked data-group="fluency">
                                        <strong>üí¨ Fluency</strong>
                                    </label>
                                    <div class="tier-children">
                                        <label class="tier-checkbox">
                                            <input type="checkbox" checked data-tier="fluency-main">
                                            Fluency_Main
                                        </label>
                                        <label class="tier-checkbox">
                                            <input type="checkbox" checked data-tier="fluency-hesitation">
                                            Fluency_Hesitation
                                        </label>
                                        <label class="tier-checkbox">
                                            <input type="checkbox" data-tier="fluency-pauses">
                                            Fluency_Pauses
                                        </label>
                                    </div>
                                </div>

                                <div class="tier-group">
                                    <label class="group-header">
                                        <input type="checkbox" checked data-group="prosody">
                                        <strong>üéµ Prosody</strong>
                                    </label>
                                    <div class="tier-children">
                                        <label class="tier-checkbox">
                                            <input type="checkbox" checked data-tier="prosody-stress">
                                            Prosody_Stress
                                        </label>
                                        <label class="tier-checkbox">
                                            <input type="checkbox" checked data-tier="prosody-rhythm">
                                            Prosody_Rhythm
                                        </label>
                                    </div>
                                </div>

                                <div class="tier-group">
                                    <label class="group-header">
                                        <input type="checkbox" data-group="discourse">
                                        <strong>üí≠ Discourse Markers</strong>
                                    </label>
                                    <div class="tier-children">
                                        <label class="tier-checkbox">
                                            <input type="checkbox" data-tier="discourse-connectors">
                                            Discourse_Connectors
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Time Range Selection -->
                        <div class="config-group">
                            <h4>Time Range</h4>
                            <div class="time-range">
                                <label>
                                    <input type="radio" name="timeRange" value="all" checked>
                                    Complete recordings
                                </label>
                                <label>
                                    <input type="radio" name="timeRange" value="custom">
                                    Custom range
                                </label>
                                <div class="custom-range" style="display: none;">
                                    <input type="time" step="0.1" placeholder="Start time">
                                    <input type="time" step="0.1" placeholder="End time">
                                </div>
                            </div>
                        </div>

                        <!-- Export Format -->
                        <div class="config-group">
                            <h4>Export Format</h4>
                            <div class="format-selection">
                                <label>
                                    <input type="radio" name="format" value="eaf" checked>
                                    ELAN (.eaf)
                                </label>
                                <label>
                                    <input type="radio" name="format" value="csv">
                                    CSV Spreadsheet
                                </label>
                                <label>
                                    <input type="radio" name="format" value="json">
                                    JSON Data
                                </label>
                                <label>
                                    <input type="radio" name="format" value="txt">
                                    Plain Text
                                </label>
                            </div>
                        </div>

                        <!-- Advanced Options -->
                        <div class="config-group">
                            <h4>Advanced Options</h4>
                            <div class="advanced-options">
                                <label class="option-checkbox">
                                    <input type="checkbox" checked>
                                    Include metadata
                                </label>
                                <label class="option-checkbox">
                                    <input type="checkbox">
                                    Merge overlapping annotations
                                </label>
                                <label class="option-checkbox">
                                    <input type="checkbox" checked>
                                    Preserve timestamps
                                </label>
                                <label class="option-checkbox">
                                    <input type="checkbox">
                                    Include contributor info
                                </label>
                            </div>
                        </div>
                    </div>
                </aside>

                <!-- Preview Area -->
                <main class="preview-area">
                    <div class="preview-header">
                        <h3>Preview</h3>
                        <div class="preview-controls">
                            <button class="view-btn active" data-view="structure">Structure</button>
                            <button class="view-btn" data-view="timeline">Timeline</button>
                            <button class="view-btn" data-view="data">Raw Data</button>
                        </div>
                    </div>

                    <!-- Structure View -->
                    <div class="preview-content" id="structureView">
                        <div class="preview-stats">
                            <div class="stat-item">
                                <strong>Files:</strong> 2 selected
                            </div>
                            <div class="stat-item">
                                <strong>Tiers:</strong> 4 selected
                            </div>
                            <div class="stat-item">
                                <strong>Annotations:</strong> ~127 total
                            </div>
                            <div class="stat-item">
                                <strong>Duration:</strong> 8:47 minutes
                            </div>
                        </div>

                        <div class="preview-structure">
                            <h4>Export Structure</h4>
                            <div class="structure-tree">
                                <div class="structure-item file">
                                    <span class="icon">üìÅ</span>
                                    <span class="name">session_001_discourse.eaf</span>
                                    <span class="count">(67 annotations)</span>
                                </div>
                                <div class="structure-children">
                                    <div class="structure-item tier">
                                        <span class="icon">üìù</span>
                                        <span class="name">Fluency_Main</span>
                                        <span class="count">(24 annotations)</span>
                                    </div>
                                    <div class="structure-item tier">
                                        <span class="icon">üìù</span>
                                        <span class="name">Fluency_Hesitation</span>
                                        <span class="count">(18 annotations)</span>
                                    </div>
                                    <div class="structure-item tier">
                                        <span class="icon">üìù</span>
                                        <span class="name">Prosody_Stress</span>
                                        <span class="count">(15 annotations)</span>
                                    </div>
                                    <div class="structure-item tier">
                                        <span class="icon">üìù</span>
                                        <span class="name">Prosody_Rhythm</span>
                                        <span class="count">(10 annotations)</span>
                                    </div>
                                </div>

                                <div class="structure-item file">
                                    <span class="icon">üìÅ</span>
                                    <span class="name">session_002_fluence.eaf</span>
                                    <span class="count">(60 annotations)</span>
                                </div>
                                <div class="structure-children">
                                    <div class="structure-item tier">
                                        <span class="icon">üìù</span>
                                        <span class="name">Fluency_Main</span>
                                        <span class="count">(32 annotations)</span>
                                    </div>
                                    <div class="structure-item tier">
                                        <span class="icon">üìù</span>
                                        <span class="name">Fluency_Hesitation</span>
                                        <span class="count">(28 annotations)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Timeline View -->
                    <div class="preview-content" id="timelineView" style="display: none;">
                        <div class="timeline-preview">
                            <div class="timeline-header">
                                <div class="time-markers">
                                    <span>0:00</span>
                                    <span>1:00</span>
                                    <span>2:00</span>
                                    <span>3:00</span>
                                    <span>4:00</span>
                                    <span>5:00</span>
                                </div>
                            </div>
                            
                            <div class="timeline-tracks">
                                <div class="track-group">
                                    <div class="track-label">session_001_discourse.eaf</div>
                                    <div class="track fluency">
                                        <div class="track-name">Fluency_Main</div>
                                        <div class="track-annotations">
                                            <div class="annotation-block" style="left: 2%; width: 4%;" title="pause_longue"></div>
                                            <div class="annotation-block" style="left: 8%; width: 3%;" title="h√©sitation"></div>
                                            <div class="annotation-block" style="left: 15%; width: 6%;" title="fluent"></div>
                                        </div>
                                    </div>
                                    <div class="track prosody">
                                        <div class="track-name">Prosody_Stress</div>
                                        <div class="track-annotations">
                                            <div class="annotation-block" style="left: 3%; width: 5%;" title="stress_primary"></div>
                                            <div class="annotation-block" style="left: 12%; width: 4%;" title="stress_secondary"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="track-group">
                                    <div class="track-label">session_002_fluence.eaf</div>
                                    <div class="track fluency">
                                        <div class="track-name">Fluency_Main</div>
                                        <div class="track-annotations">
                                            <div class="annotation-block" style="left: 1%; width: 3%;" title="normal"></div>
                                            <div class="annotation-block" style="left: 6%; width: 2%;" title="pause"></div>
                                            <div class="annotation-block" style="left: 10%; width: 5%;" title="h√©sitation_longue"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Raw Data View -->
                    <div class="preview-content" id="dataView" style="display: none;">
                        <div class="data-preview">
                            <h4>Sample Export Data</h4>
                            <pre class="data-sample"><code id="dataSample">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ANNOTATION_DOCUMENT&gt;
    &lt;HEADER&gt;
        &lt;MEDIA_DESCRIPTOR MEDIA_URL="session_001_discourse.wav" /&gt;
    &lt;/HEADER&gt;
    &lt;TIME_ORDER&gt;
        &lt;TIME_SLOT TIME_SLOT_ID="ts1" TIME_VALUE="5000" /&gt;
        &lt;TIME_SLOT TIME_SLOT_ID="ts2" TIME_VALUE="10200" /&gt;
        &lt;TIME_SLOT TIME_SLOT_ID="ts3" TIME_VALUE="25000" /&gt;
        &lt;TIME_SLOT TIME_SLOT_ID="ts4" TIME_VALUE="30000" /&gt;
    &lt;/TIME_ORDER&gt;
    &lt;TIER TIER_ID="Fluency_Main"&gt;
        &lt;ANNOTATION&gt;
            &lt;ALIGNABLE_ANNOTATION ANNOTATION_ID="a1" TIME_SLOT_REF1="ts1" TIME_SLOT_REF2="ts2"&gt;
                &lt;ANNOTATION_VALUE&gt;pause_longue&lt;/ANNOTATION_VALUE&gt;
            &lt;/ALIGNABLE_ANNOTATION&gt;
        &lt;/ANNOTATION&gt;
        &lt;ANNOTATION&gt;
            &lt;ALIGNABLE_ANNOTATION ANNOTATION_ID="a2" TIME_SLOT_REF1="ts3" TIME_SLOT_REF2="ts4"&gt;
                &lt;ANNOTATION_VALUE&gt;h√©sitation_marqu√©e&lt;/ANNOTATION_VALUE&gt;
            &lt;/ALIGNABLE_ANNOTATION&gt;
        &lt;/ANNOTATION&gt;
    &lt;/TIER&gt;
&lt;/ANNOTATION_DOCUMENT&gt;
                            </code></pre>
                        </div>
                    </div>

                    <!-- Export Queue -->
                    <div class="export-queue">
                        <h4>Export Queue</h4>
                        <div class="queue-list" id="exportQueue">
                            <div class="queue-item">
                                <div class="queue-info">
                                    <strong>LSFB_Fluency_Export.eaf</strong>
                                    <span>Ready to download</span>
                                </div>
                                <div class="queue-actions">
                                    <button class="btn-xs primary">Download</button>
                                    <button class="btn-xs">Remove</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </main>

    <!-- Export Progress Modal -->
    <div id="exportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Generating Export</h3>
            </div>
            <div class="modal-body">
                <div class="export-progress">
                    <div class="progress-step active">
                        <span class="step-icon">‚úÖ</span>
                        <span class="step-text">Validating selections</span>
                    </div>
                    <div class="progress-step active">
                        <span class="step-icon">‚úÖ</span>
                        <span class="step-text">Processing files</span>
                    </div>
                    <div class="progress-step current">
                        <span class="step-icon">üîÑ</span>
                        <span class="step-text">Merging annotations</span>
                    </div>
                    <div class="progress-step">
                        <span class="step-icon">‚è≥</span>
                        <span class="step-text">Generating output</span>
                    </div>
                    <div class="progress-step">
                        <span class="step-icon">‚è≥</span>
                        <span class="step-text">Finalizing export</span>
                    </div>
                </div>
                
                <div class="progress-bar-container">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 60%;"></div>
                    </div>
                    <span class="progress-text">Processing... 60%</span>
                </div>
            </div>
        </div>
    </div>

    <script src="auth.js"></script>
    <script src="script.js"></script>
    <script>
        function saveConfiguration() {
            const config = gatherConfiguration();
            localStorage.setItem('exportConfig', JSON.stringify(config));
            alert('Configuration saved!');
        }
        
        function generateExport() {
            showModal('exportModal');
            
            // Simulate export process
            setTimeout(() => {
                closeModal('exportModal');
                addToExportQueue();
            }, 3000);
        }
        
        function gatherConfiguration() {
            return {
                files: Array.from(document.querySelectorAll('[data-file]:checked')).map(el => el.dataset.file),
                tiers: Array.from(document.querySelectorAll('[data-tier]:checked')).map(el => el.dataset.tier),
                format: document.querySelector('[name="format"]:checked').value,
                timeRange: document.querySelector('[name="timeRange"]:checked').value
            };
        }
        
        function addToExportQueue() {
            const queueList = document.getElementById('exportQueue');
            const config = gatherConfiguration();
            const filename = `LSFB_Export_${Date.now()}.${config.format}`;
            
            const queueItem = document.createElement('div');
            queueItem.className = 'queue-item';
            queueItem.innerHTML = `
                <div class="queue-info">
                    <strong>${filename}</strong>
                    <span>Ready to download</span>
                </div>
                <div class="queue-actions">
                    <button class="btn-xs primary" onclick="downloadFile('${filename}')">Download</button>
                    <button class="btn-xs" onclick="removeFromQueue(this)">Remove</button>
                </div>
            `;
            
            queueList.appendChild(queueItem);
        }
        
        function downloadFile(filename) {
            alert(`Downloading ${filename}...`);
            // Implementation for actual file download
        }
        
        function removeFromQueue(button) {
            button.closest('.queue-item').remove();
        }
        
        // View switching
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Hide all views
                    document.querySelectorAll('.preview-content').forEach(view => {
                        view.style.display = 'none';
                    });
                    
                    // Show selected view
                    const viewName = this.dataset.view;
                    document.getElementById(viewName + 'View').style.display = 'block';
                    
                    if (viewName === 'data') {
                        updateDataPreview();
                    }
                });
            });
            
            // Handle tier group checkboxes
            document.querySelectorAll('[data-group]').forEach(groupCheckbox => {
                groupCheckbox.addEventListener('change', function() {
                    const group = this.dataset.group;
                    const tierCheckboxes = document.querySelectorAll(`[data-tier^="${group}"]`);
                    tierCheckboxes.forEach(cb => cb.checked = this.checked);
                });
            });
            
            // Handle format change
            document.querySelectorAll('[name="format"]').forEach(radio => {
                radio.addEventListener('change', updateDataPreview);
            });
        });
        
        function updateDataPreview() {
            const format = document.querySelector('[name="format"]:checked').value;
            const dataSample = document.getElementById('dataSample');
            
            switch(format) {
                case 'csv':
                    dataSample.textContent = `File,Tier,Start_Time,End_Time,Annotation,Contributor
session_001_discourse.eaf,Fluency_Main,0:05.0,0:10.2,pause_longue,Dr. Martin
session_001_discourse.eaf,Fluency_Main,0:25.0,0:30.0,h√©sitation_marqu√©e,Prof. Laurent
session_002_fluence.eaf,Fluency_Main,0:01.5,0:03.2,normal,Dr. Martin`;
                    break;
                case 'json':
                    dataSample.textContent = `{
  "files": [
    {
      "filename": "session_001_discourse.eaf",
      "tiers": [
        {
          "name": "Fluency_Main",
          "annotations": [
            {
              "start": 5.0,
              "end": 10.2,
              "value": "pause_longue",
              "contributor": "Dr. Martin"
            }
          ]
        }
      ]
    }
  ]
}`;
                    break;
                case 'txt':
                    dataSample.textContent = `LSFB Discourse Analysis Export
=====================================

File: session_001_discourse.eaf
--------------------------------
[0:05.0-0:10.2] Fluency_Main: pause_longue (Dr. Martin)
[0:25.0-0:30.0] Fluency_Main: h√©sitation_marqu√©e (Prof. Laurent)

File: session_002_fluence.eaf
-----------------------------
[0:01.5-0:03.2] Fluency_Main: normal (Dr. Martin)`;
                    break;
                default: // eaf
                    dataSample.innerHTML = `&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ANNOTATION_DOCUMENT&gt;
    &lt;HEADER&gt;
        &lt;MEDIA_DESCRIPTOR MEDIA_URL="session_001_discourse.wav" /&gt;
    &lt;/HEADER&gt;
    &lt;TIME_ORDER&gt;
        &lt;TIME_SLOT TIME_SLOT_ID="ts1" TIME_VALUE="5000" /&gt;
        &lt;TIME_SLOT TIME_SLOT_ID="ts2" TIME_VALUE="10200" /&gt;
    &lt;/TIME_ORDER&gt;
    &lt;TIER TIER_ID="Fluency_Main"&gt;
        &lt;ANNOTATION&gt;
            &lt;ALIGNABLE_ANNOTATION ANNOTATION_ID="a1" TIME_SLOT_REF1="ts1" TIME_SLOT_REF2="ts2"&gt;
                &lt;ANNOTATION_VALUE&gt;pause_longue&lt;/ANNOTATION_VALUE&gt;
            &lt;/ALIGNABLE_ANNOTATION&gt;
        &lt;/ANNOTATION&gt;
    &lt;/TIER&gt;
&lt;/ANNOTATION_DOCUMENT&gt;`;
            }
        }
    </script>
</body>
</html>
